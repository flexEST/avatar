<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Asistent</title>
  <style>
    body {
      margin: 0;
      background-color: white;
      overflow: hidden;
    }

    #videoContainer {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40vw;
      z-index: 999;
    }

    video {
      width: 100%;
      border-radius: 12px;
    }
  </style>
</head>
<body>

<div id="videoContainer"></div>

<script>
  const videoContainer = document.getElementById("videoContainer");

  const videos = {
    "f": "videos/greeting.mp4",
    "1": "videos/option1.mp4",
    "2": "videos/option2.mp4",
    "3": "videos/option3.mp4",
    "4": "videos/option4.mp4"
  };

  let state = "idle"; // idle, playing, waiting-reply
  let idleVideo = null;

  function playVideo(src, muted = false, loop = false, onEnd = null) {
    stopCurrentVideo();

    const video = document.createElement("video");
    video.src = src;
    video.autoplay = true;
    video.playsInline = true;
    video.muted = muted;
    video.loop = loop;
    video.controls = false;

    videoContainer.innerHTML = '';
    videoContainer.appendChild(video);
    videoContainer.style.display = 'block';

    if (!loop && onEnd) {
      video.onended = onEnd;
    }
  }

  function stopCurrentVideo() {
    videoContainer.innerHTML = '';
    videoContainer.style.display = 'none';
  }

  function playIdleVideo() {
    stopCurrentVideo();

    idleVideo = document.createElement("video");
    idleVideo.src = "videos/idle.mp4";
    idleVideo.autoplay = true;
    idleVideo.playsInline = true;
    idleVideo.muted = true;
    idleVideo.loop = true;
    idleVideo.controls = false;

    videoContainer.appendChild(idleVideo);
    videoContainer.style.display = 'block';
    state = "idle";
  }

  function handleFollowUpChoice(key) {
    if (key === "1") {
      // Söhbəti sonlandır
      stopCurrentVideo();
      state = "idle";
    } else if (key === "2") {
      // Başa qayıt
      state = "playing";
      playVideo("videos/greeting.mp4", false, false, () => {
        playIdleVideo();
      });
    }
  }

  window.addEventListener("keydown", (e) => {
    const key = e.key.toLowerCase();

    if (state === "idle" && key === "f") {
      state = "playing";
      playVideo("videos/greeting.mp4", false, false, () => {
        playIdleVideo();
      });
    }

    if (state === "idle" && ["1", "2", "3", "4"].includes(key)) {
      state = "playing";
      playVideo(`videos/option${key}.mp4`, false, false, () => {
        // Video bitdikdən sonra 1 və 2 variantları üçün gözləmə rejiminə keç
        state = "waiting-reply";
      });
    }

    if (state === "waiting-reply" && (key === "1" || key === "2")) {
      handleFollowUpChoice(key);
    }
  });

</script>

</body>
</html>
