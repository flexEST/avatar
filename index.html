<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Köməkçi</title>
  <style>
    body {
      margin: 0;
      background: white;
      overflow: hidden;
    }
    #assistantContainer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 220px;
      height: 320px;
      display: none;
      border-radius: 12px;
      overflow: hidden;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #micBtn {
      display: none;
    }
  </style>
</head>
<body>
  <div id="assistantContainer">
    <video id="idleVideo" src="videos/idle.mp4" loop muted></video>
    <video id="talkingVideo" src="videos/talking.mp4" style="display: none;"></video>
  </div>
  <audio id="audio"></audio>

  <script>
    const assistant = document.getElementById('assistantContainer');
    const idleVideo = document.getElementById('idleVideo');
    const talkingVideo = document.getElementById('talkingVideo');
    const audio = document.getElementById('audio');

    // Audio paths
    const greetingAudio = 'audio/greeting.mp3';
    const kitabAudio = 'audio/kitab.mp3';
    const saytAudio = 'audio/sayt.mp3';
    const havaAudio = 'audio/hava.mp3';
    const basaDusmedimAudio = 'audio/basadusmedim.mp3';

    // Mikrafon tanıma (Web Speech API)
    let recognition;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'az-AZ';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        if (transcript.includes('kitab')) {
          playTalkingWithAudio(kitabAudio);
        } else if (transcript.includes('sayt')) {
          playTalkingWithAudio(saytAudio);
        } else if (transcript.includes('hava')) {
          playTalkingWithAudio(havaAudio);
        } else {
          playTalkingWithAudio(basaDusmedimAudio);
        }
      };
    }

    // Play talking video with synced audio
    function playTalkingWithAudio(audioFile) {
      idleVideo.style.display = 'none';
      talkingVideo.style.display = 'block';
      talkingVideo.currentTime = 0;
      talkingVideo.play();

      audio.src = audioFile;
      audio.play();

      audio.onended = () => {
        talkingVideo.pause();
        talkingVideo.currentTime = 0;

        talkingVideo.style.display = 'none';
        idleVideo.style.display = 'block';
        idleVideo.play();
      };
    }

    // Start with assistant hidden, press F to activate
    document.addEventListener('keydown', (e) => {
      if (e.key === 'f') {
        assistant.style.display = 'block';
        idleVideo.style.display = 'none';
        talkingVideo.style.display = 'block';
        talkingVideo.currentTime = 0;
        talkingVideo.play();

        audio.src = greetingAudio;
        audio.play();

        audio.onended = () => {
          talkingVideo.pause();
          talkingVideo.currentTime = 0;

          talkingVideo.style.display = 'none';
          idleVideo.style.display = 'block';
          idleVideo.play();

          // Start microphone
          if (recognition) recognition.start();
        };
      }
    });
  </script>
</body>
</html>
