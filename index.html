<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Audio Assistant</title>
  <style>
    body {
      margin: 0;
      background: white;
      overflow: hidden;
    }
    #videoContainer {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 250px;
      height: auto;
      display: none;
      z-index: 9999;
    }
    video {
      width: 100%;
      border-radius: 20px;
    }
  </style>
</head>
<body>

<div id="videoContainer">
  <video id="assistantVideo" muted loop>
    <source src="videos/idle.mp4" type="video/mp4" />
  </video>
</div>

<script>
  const videoContainer = document.getElementById('videoContainer');
  const assistantVideo = document.getElementById('assistantVideo');

  const audioGreeting = new Audio('audio/greeting.mp3');
  const audioKitab = new Audio('audio/kitab.mp3');
  const audioSayt = new Audio('audio/sayt.mp3');
  const audioHava = new Audio('audio/hava.mp3');
  const audioBasaDusmedim = new Audio('audio/basa_dusmedim.mp3');

  let currentAudio = null;

  function playVideo(src, loop = true) {
    assistantVideo.loop = loop;
    assistantVideo.src = src;
    assistantVideo.load();
    assistantVideo.play();
  }

  function playAudio(audio, callback) {
    if (currentAudio) currentAudio.pause();
    currentAudio = audio;
    currentAudio.currentTime = 0;
    currentAudio.play();
    currentAudio.onended = () => {
      if (callback) callback();
    };
  }

  function switchToIdle() {
    playVideo("videos/idle.mp4", true);
  }

  function handleVoiceCommand(text) {
    let matched = false;

    const lowerText = text.toLowerCase();

    if (lowerText.includes("kitab")) {
      matched = true;
      playVideo("videos/talking.mp4", false);
      playAudio(audioKitab, switchToIdle);
    } else if (lowerText.includes("sayt")) {
      matched = true;
      playVideo("videos/talking.mp4", false);
      playAudio(audioSayt, switchToIdle);
    } else if (lowerText.includes("hava")) {
      matched = true;
      playVideo("videos/talking.mp4", false);
      playAudio(audioHava, switchToIdle);
    }

    if (!matched) {
      playVideo("videos/talking.mp4", false);
      playAudio(audioBasaDusmedim, switchToIdle);
    }
  }

  function startRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Sənin brauzerin səs tanımanı dəstəkləmir.");
      return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = "az-AZ";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      handleVoiceCommand(transcript);
    };

    recognition.onerror = () => {
      playVideo("videos/talking.mp4", false);
      playAudio(audioBasaDusmedim, switchToIdle);
    };
  }

  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'f') {
      videoContainer.style.display = 'block';
      playVideo("videos/talking.mp4", false);
      playAudio(audioGreeting, switchToIdle);
    }
    if (e.key.toLowerCase() === 'm') {
      startRecognition();
    }
  });
</script>
</body>
</html>
